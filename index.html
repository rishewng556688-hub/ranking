<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å¥–åŠ±æ’åç³»ç»Ÿ</title>

<style>
:root{
  --bg:#f4f6f9;
  --card:#ffffff;
  --primary:#2563eb;
  --danger:#dc2626;
  --border:#e5e7eb;
  --text:#1f2937;
  --muted:#6b7280;
}

body{
  margin:0;
  padding:30px;
  background:var(--bg);
  font-family:"Segoe UI","PingFang SC","Microsoft YaHei",sans-serif;
  color:var(--text);
}

h2{
  text-align:center;
  margin-bottom:20px;
  font-weight:600;
}

.card{
  max-width:1100px;
  margin:auto;
  background:var(--card);
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.05);
  padding:20px;
}

.controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:15px;
}

.controls-left{
  display:flex;
  align-items:center;
  gap:10px;
}

select{
  padding:6px 12px;
  border-radius:8px;
  border:1px solid var(--border);
}

button{
  padding:7px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-size:14px;
}

.btn-primary{background:var(--primary);color:#fff;}
.btn-secondary{background:#e5e7eb;}
.btn-danger{background:#fee2e2;color:#b91c1c;}
.btn-danger:hover{background:#fecaca;}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:10px 12px;
  border-bottom:1px solid var(--border);
  text-align:center;
}

thead th{
  position:sticky;
  top:0;
  background:#f9fafb;
  color:var(--muted);
  font-weight:500;
}

tr:hover{background:#f9fafb;}

.top1{background:linear-gradient(90deg,#fff7cc,#fff);}
.top2{background:linear-gradient(90deg,#f1f5f9,#fff);}
.top3{background:linear-gradient(90deg,#fef3c7,#fff);}
.top4,.top5{background:linear-gradient(90deg,#eef2ff,#fff);}

.rank{font-weight:600;font-size:16px;}
.top1 .rank::before{content:"ğŸ¥‡ ";}
.top2 .rank::before{content:"ğŸ¥ˆ ";}
.top3 .rank::before{content:"ğŸ¥‰ ";}
.top4 .rank::before,.top5 .rank::before{content:"â­ ";}

.editable{
  padding:2px 6px;
  border-radius:6px;
}
.editable[contenteditable="true"]{
  background:#fff7cc;
  outline:1px dashed #f59e0b;
}
tr.editing{background:#eef2ff !important;}

.action-btn{
  padding:5px 10px;
  font-size:12px;
  opacity:0;
  transition:.2s;
}
tr:hover .action-btn{opacity:1;}

.high{color:#16a34a;font-weight:600;}
.mid{color:#ca8a04;}
.low{color:#6b7280;}
</style>
</head>

<body>

<h2>ğŸ† å¥–åŠ±æ’åç³»ç»Ÿ / Reward Ranking System</h2>

<div class="card" id="captureArea">
  <div class="controls">
    <div class="controls-left">
      <span>æ’åä¾æ® / Ranking byï¼š</span>
      <select id="rankType" onchange="updateRanking();saveData();">
        <option value="performance">ä¸šç»© / Total Money</option>
        <option value="push">æ¨é€ / Clients Push</option>
        <option value="first">é¦–å­˜ / First Deposit</option>
      </select>
    </div>

    <div>
      <button class="btn-secondary" onclick="unlockEdit()">ğŸ”“ ç¼–è¾‘</button>
      <button class="btn-primary" id="lockBtn" onclick="lockEdit()" style="display:none;">ğŸ”’ é”å®š</button>
      <button class="btn-primary" onclick="addPerson()">â• æ·»åŠ </button>
      <button class="btn-primary" onclick="capturePage()">ğŸ“¸ ä¸€é”®æˆªå›¾</button>
      <button class="btn-primary" onclick="captureAll()">ğŸ“¸ å¯¼å‡ºä¸‰ç§æ’å</button>
    </div>
  </div>

  <table id="rankingTable">
    <thead>
      <tr>
        <th>æ’å</th>
        <th>å§“å</th>
        <th>æ¨é€</th>
        <th>é¦–å­˜</th>
        <th>ä¸šç»©</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const STORAGE_KEY="ranking_system_data";
let isUnlocked=false;

const defaultData=[
  {name:"å¼ ä¸‰",push:120,first:50,performance:300},
  {name:"æå››",push:90,first:40,performance:250},
  {name:"ç‹äº”",push:80,first:35,performance:200},
  {name:"èµµå…­",push:70,first:30,performance:180},
  {name:"å­™ä¸ƒ",push:60,first:25,performance:160}
];

function unlockEdit(){
  isUnlocked=true;
  document.querySelectorAll(".editable").forEach(e=>e.contentEditable="true");
  document.getElementById("lockBtn").style.display="inline-block";
}
function lockEdit(){
  isUnlocked=false;
  document.querySelectorAll(".editable").forEach(e=>e.contentEditable="false");
  document.getElementById("lockBtn").style.display="none";
  saveData();
}

function applyValueStyle(el){
  if(el.classList.contains("name")) return;
  const v=Number(el.innerText);
  el.classList.remove("high","mid","low");
  if(v>=200) el.classList.add("high");
  else if(v>=100) el.classList.add("mid");
  else el.classList.add("low");
}

function renderTable(data){
  const tbody=document.querySelector("#rankingTable tbody");
  tbody.innerHTML="";
  data.forEach(d=>{
    const tr=tbody.insertRow();
    tr.innerHTML=`
      <td></td>
      <td class="editable name">${d.name}</td>
      <td class="editable push">${d.push}</td>
      <td class="editable first">${d.first}</td>
      <td class="editable performance">${d.performance}</td>
      <td><button class="btn-danger action-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
    `;
    tr.querySelectorAll(".editable").forEach(el=>{
      el.contentEditable="false";
      applyValueStyle(el);
      el.addEventListener("focus",()=>tr.classList.add("editing"));
      el.addEventListener("blur",()=>{
        tr.classList.remove("editing");
        if(!el.classList.contains("name")){
          el.innerText=el.innerText.replace(/[^\d\-]/g,"")||"0";
        }
        applyValueStyle(el);
        updateRanking();
        saveData();
      });
    });
  });
  updateRanking();
}

function addPerson(){
  if(!isUnlocked) return alert("è¯·å…ˆç¼–è¾‘");
  const name=prompt("è¯·è¾“å…¥å§“å");
  if(!name) return;
  const data=loadData();
  data.push({name,push:0,first:0,performance:0});
  saveData(data);
  renderTable(data);
}

function deleteRow(btn){
  if(!isUnlocked) return alert("è¯·å…ˆç¼–è¾‘");
  if(!confirm("ç¡®å®šåˆ é™¤ï¼Ÿ")) return;
  btn.closest("tr").remove();
  updateRanking();
  saveData();
}

function updateRanking(){
  const tbody=document.querySelector("#rankingTable tbody");
  const rows=[...tbody.rows];
  const type=document.getElementById("rankType").value;
  rows.sort((a,b)=>
    Number(b.querySelector("."+type).innerText) -
    Number(a.querySelector("."+type).innerText)
  );
  rows.forEach((r,i)=>{
    r.cells[0].innerHTML=`<span class="rank">${i+1}</span>`;
    r.className="";
    if(i===0) r.classList.add("top1");
    if(i===1) r.classList.add("top2");
    if(i===2) r.classList.add("top3");
    if(i===3) r.classList.add("top4");
    if(i===4) r.classList.add("top5");
    tbody.appendChild(r);
  });
}

function saveData(data){
  if(!data){
    data=[];
    document.querySelectorAll("#rankingTable tbody tr").forEach(r=>{
      data.push({
        name:r.querySelector(".name").innerText,
        push:+r.querySelector(".push").innerText,
        first:+r.querySelector(".first").innerText,
        performance:+r.querySelector(".performance").innerText
      });
    });
  }
  localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
}

function loadData(){
  const raw=localStorage.getItem(STORAGE_KEY);
  return raw?JSON.parse(raw):defaultData;
}

/* ä¸€é”®æˆªå›¾ */
function capturePage(){
  lockEdit();
  setTimeout(()=>{
    html2canvas(document.getElementById("captureArea"),{
      scale:2,
      backgroundColor:"#ffffff"
    }).then(canvas=>{
      const a=document.createElement("a");
      a.download="å¥–åŠ±æ’åæˆªå›¾.png";
      a.href=canvas.toDataURL("image/png");
      a.click();
    });
  },200);
}

/* è‡ªåŠ¨å¯¼å‡ºä¸‰ç§æ’å */
async function captureAll(){
  lockEdit();

  const select = document.getElementById("rankType");
  const originalValue = select.value;

  const configs = [
    { value: "performance", name: "ä¸šç»©" },
    { value: "push",        name: "æ¨é€" },
    { value: "first",       name: "é¦–å­˜" }
  ];

  for(const cfg of configs){
    select.value = cfg.value;
    updateRanking();
    saveData();

    await new Promise(r => setTimeout(r, 300));

    const canvas = await html2canvas(
      document.getElementById("captureArea"),
      { scale:2, backgroundColor:"#ffffff" }
    );

    const a = document.createElement("a");
    a.download = `å¥–åŠ±æ’å-${cfg.name}.png`;
    a.href = canvas.toDataURL("image/png");
    a.click();

    await new Promise(r => setTimeout(r, 300));
  }

  select.value = originalValue;
  updateRanking();
}

renderTable(loadData());
</script>

</body>
</html>
