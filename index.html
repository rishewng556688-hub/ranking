<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å¥–åŠ±æ’åç³»ç»Ÿ</title>
<style>
:root{
  --bg:#f4f6f9; --card:#fff; --primary:#2563eb; --danger:#dc2626;
  --border:#e5e7eb; --text:#1f2937; --muted:#6b7280;
}
body{margin:0;padding:30px;background:var(--bg);font-family:"Segoe UI","PingFang SC","Microsoft YaHei",sans-serif;color:var(--text);}
h2{text-align:center;margin-bottom:20px;font-weight:600;}
.card{max-width:1100px;margin:auto;background:var(--card);border-radius:14px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.06);}
.controls{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:15px;}
select,button{padding:7px 14px;border-radius:10px;border:1px solid #e5e7eb;}
.btn-primary{background:var(--primary);color:#fff;border:none;}
.btn-secondary{background:#e5e7eb;border:none;}
.btn-danger{background:var(--danger);color:#fff;border:none;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:12px;border-bottom:1px solid var(--border);text-align:center;}
th{background:#f9fafb;color:var(--muted);}
.top1{background:#fff7cc;}
.top2{background:#f1f5f9;}
.top3{background:#fef3c7;}
.editable[contenteditable="true"]{background:#fff7cc;outline:1px dashed #f59e0b;}
</style>
</head>
<body>
<h2>ğŸ† å¥–åŠ±æ’åç³»ç»Ÿ</h2>
<div class="card">
  <div class="controls">
    <div>æ’åä¾æ® / Ranking byï¼š
      <select id="rankType" onchange="updateRanking()">
        <option value="performance">ä¸šç»© / Total Money</option>
        <option value="push">æ¨é€ / Clients Push</option>
        <option value="first">é¦–å­˜ / First Deposit</option>
      </select>
    </div>
    <div>
      <button class="btn-secondary" onclick="unlockEdit()">ğŸ”“ è§£é”ç¼–è¾‘</button>
      <button class="btn-primary" onclick="saveToGitHub()">â˜ï¸ ä¿å­˜åˆ°äº‘ç«¯</button>
      <button class="btn-primary" onclick="addPerson()">â• æ·»åŠ äººå‘˜</button>
    </div>
  </div>
  <table id="table">
    <thead>
      <tr>
        <th>æ’å</th><th>å§“å</th><th>æ¨é€</th><th>é¦–å­˜</th><th>ä¸šç»©</th><th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ğŸ›¡ï¸ é…ç½®
const EDIT_PASSWORD  = "qwe556688.";
const CLOUD_PASSWORD = "qwe556688.";
const GITHUB_USER    = "ä½ çš„GitHubç”¨æˆ·å";   // æ›¿æ¢
const REPO_NAME      = "ranking-system";    // æ›¿æ¢
const FILE_PATH      = "data.json";
const BRANCH         = "main";
const GITHUB_TOKEN   = "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"; // æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Token

let data = [];
let isUnlocked = false;

// è¯»å–äº‘ç«¯ JSON
fetch("data.json").then(r=>r.json()).then(d=>{data=d;render();});

// ğŸ”“ è§£é”ç¼–è¾‘
function unlockEdit(){
  if(prompt("è¯·è¾“å…¥ç¼–è¾‘å¯†ç ï¼š")!==EDIT_PASSWORD){alert("å¯†ç é”™è¯¯"); return;}
  isUnlocked=true;
  document.querySelectorAll(".editable").forEach(e=>e.contentEditable="true");
  alert("å·²è¿›å…¥ç¼–è¾‘æ¨¡å¼");
}

// ğŸš€ æ¸²æŸ“è¡¨æ ¼
function render(){
  const tbody=document.querySelector("tbody");
  tbody.innerHTML="";
  data.forEach(d=>{
    const tr=tbody.insertRow();
    tr.innerHTML=`
      <td></td>
      <td class="editable name">${d.name}</td>
      <td class="editable push">${d.push}</td>
      <td class="editable first">${d.first}</td>
      <td class="editable performance">${d.performance}</td>
      <td><button class="btn-danger" onclick="del(this)">åˆ é™¤</button></td>
    `;
    tr.querySelectorAll(".editable").forEach(td=>{
      td.contentEditable=false;
      td.oninput=()=>{
        if(!td.classList.contains("name")) td.innerText = td.innerText.replace(/\D/g,"");
        sync();
      };
    });
  });
  updateRanking();
}

// åŒæ­¥è¡¨æ ¼åˆ° data æ•°ç»„
function sync(){
  data=[...document.querySelectorAll("tbody tr")].map(r=>({
    name:r.querySelector(".name").innerText,
    push:+r.querySelector(".push").innerText,
    first:+r.querySelector(".first").innerText,
    performance:+r.querySelector(".performance").innerText
  }));
  updateRanking();
}

// æ’åæ›´æ–°
function updateRanking(){
  const type=document.getElementById("rankType").value;
  data.sort((a,b)=>b[type]-a[type]);
  const rows=[...document.querySelectorAll("tbody tr")];
  rows.forEach((r,i)=>{
    r.cells[0].innerText=i+1;
    r.className=i===0?"top1":i===1?"top2":i===2?"top3":"";
  });
}

// æ·»åŠ äººå‘˜
function addPerson(){
  if(!isUnlocked){alert("è¯·å…ˆè§£é”");return;}
  data.push({name:"æ–°æˆå‘˜",push:0,first:0,performance:0});
  render();
}

// åˆ é™¤äººå‘˜
function del(btn){
  if(!isUnlocked){alert("è¯·å…ˆè§£é”");return;}
  btn.closest("tr").remove();
  sync();
}

// â˜ï¸ ä¿å­˜åˆ° GitHub äº‘ç«¯
async function saveToGitHub(){
  if(!isUnlocked){alert("è¯·å…ˆè§£é”");return;}
  if(prompt("è¯·è¾“å…¥äº‘ç«¯ä¿å­˜å¯†ç ï¼š")!==CLOUD_PASSWORD){alert("äº‘ç«¯å¯†ç é”™è¯¯");return;}
  sync();
  const api=`https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents/${FILE_PATH}`;
  const res = await fetch(api,{headers:{"Authorization":`token ${GITHUB_TOKEN}`}});
  const file = await res.json();
  const content = btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2))));
  await fetch(api,{
    method:"PUT",
    headers:{"Authorization":`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"},
    body:JSON.stringify({message:"Update ranking data",content,sha:file.sha,branch:BRANCH})
  });
  alert("âœ… å·²æˆåŠŸä¿å­˜åˆ°äº‘ç«¯ï¼Œæ‰€æœ‰äººå·²åŒæ­¥");
}
</script>
</body>
</html>
