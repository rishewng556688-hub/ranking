<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å¥–åŠ±æ’åç³»ç»Ÿ</title>
<style>
body{font-family:sans-serif;padding:20px;background:#f4f6f9;}
table{width:100%;border-collapse:collapse;table-layout:auto;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;word-break:break-word;}
.editable[contenteditable="true"]{background:#fff7cc;}
button{padding:5px 10px;margin:2px;}
</style>
</head>
<body>
<h2>ğŸ† å¥–åŠ±æ’åç³»ç»Ÿ</h2>

<label>æ’åä¾æ®ï¼š
<select id="rankType">
  <option value="performance">ä¸šç»© / Total Money</option>
  <option value="push">æ¨é€ / Clients Push</option>
  <option value="first">é¦–å­˜ / First Deposit</option>
</select>
</label>
<button onclick="unlockEdit()">ğŸ”“ è§£é”ç¼–è¾‘</button>
<button onclick="saveCloud()">â˜ï¸ ä¿å­˜åˆ°äº‘ç«¯</button>
<button onclick="addPerson()">â• æ·»åŠ äººå‘˜</button>

<table id="table">
<thead>
<tr>
<th>æ’å / Ranking</th>
<th>å§“å / Name</th>
<th>æ¨é€ / Clients Push</th>
<th>é¦–å­˜ / First Deposit</th>
<th>ä¸šç»© / Total Money</th>
<th>æ“ä½œ / Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const CLOUD_PASSWORD = "qwe556688.";
let data = [];
let unlocked = false;

// è¯»å– data.json
fetch('data.json?t='+Date.now())
  .then(r=>r.json())
  .then(d=>{data=d;render();})
  .catch(()=>{data=[{"name":"å¼ ä¸‰","push":120,"first":50,"performance":300},{"name":"æå››","push":90,"first":40,"performance":250}];render();});

// æ¸²æŸ“è¡¨æ ¼
function render(){
  const tbody = document.querySelector("tbody");
  tbody.innerHTML = "";
  data.forEach(d=>{
    const tr = tbody.insertRow();
    tr.innerHTML = `<td></td>
      <td class="editable name">${d.name}</td>
      <td class="editable push">${d.push}</td>
      <td class="editable first">${d.first}</td>
      <td class="editable performance">${d.performance}</td>
      <td><button onclick="del(this)">åˆ é™¤</button></td>`;
    tr.querySelectorAll(".editable").forEach(td=>{
      td.contentEditable=false;
      td.oninput=()=>{if(!td.classList.contains("name")) td.innerText = td.innerText.replace(/\D/g,""); sync();}
    });
  });
  updateRanking();
}

// è§£é”ç¼–è¾‘
function unlockEdit(){unlocked = true; document.querySelectorAll(".editable").forEach(td=>td.contentEditable=true); alert("å·²è§£é”ç¼–è¾‘");}

// æ·»åŠ äººå‘˜
function addPerson(){if(!unlocked){alert("è¯·å…ˆè§£é”"); return;} data.push({name:"æ–°æˆå‘˜",push:0,first:0,performance:0}); render();}

// åˆ é™¤
function del(btn){if(!unlocked){alert("è¯·å…ˆè§£é”"); return;} btn.closest("tr").remove(); sync();}

// åŒæ­¥ data
function sync(){
  data=[...document.querySelectorAll("tbody tr")].map(r=>({
    name:r.querySelector(".name").innerText,
    push:+r.querySelector(".push").innerText,
    first:+r.querySelector(".first").innerText,
    performance:+r.querySelector(".performance").innerText
  }));
  updateRanking();
}

// æ’å
function updateRanking(){
  const type = document.getElementById("rankType").value;
  data.sort((a,b)=>b[type]-a[type]);
  [...document.querySelectorAll("tbody tr")].forEach((r,i)=>{r.cells[0].innerText=i+1;});
}

// ä¿å­˜åˆ°äº‘ç«¯
async function saveCloud(){
  if(!unlocked){alert("è¯·å…ˆè§£é”");return;}
  if(prompt("è¯·è¾“å…¥äº‘ç«¯å¯†ç ")!==CLOUD_PASSWORD){alert("å¯†ç é”™è¯¯"); return;}
  sync();
  const json = JSON.stringify(data);
  const workflowApi = `https://api.github.com/repos/rishewng556688-hub/ranking/actions/workflows/save.yml/dispatches`;
  await fetch(workflowApi,{
    method:"POST",
    headers:{
      "Accept":"application/vnd.github+json",
      "Authorization":"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",
      "Content-Type":"application/json"
    },
    body: JSON.stringify({ref:"main",inputs:{data:json}})
  }).then(r=>{if(r.ok) alert("âœ… ä¿å­˜æˆåŠŸï¼Œåˆ·æ–°é¡µé¢æ˜¾ç¤ºæœ€æ–°æ•°æ®"); else alert("âŒ ä¿å­˜å¤±è´¥");});
}
</script>
</body>
</html>
